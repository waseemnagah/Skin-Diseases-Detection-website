<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/55baaca549.js" crossorigin="anonymous"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.2/iconify-icon.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <link rel="shortcut icon" type="image/png" href="/static/Images/Picture2.png">
    <title>Skin Diseases</title>
</head>

<body>
    <div>
        <!--nav bar-->
        <nav class="navbar navbar-expand-md navbar-light bg-info ">
            <a id="logo-color" class="navbar-brand logo fs-3 mx-3 text-white" href="#">Skin Diseases Detection</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01"
                aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                <ul class="navbar-nav ms-auto pr-3 mr-5">
                    <li class="nav-item px-3">
                        <a class="nav-link" id="nav-color" href="#">Home</a>
                    </li>
                    <li class="nav-item px-3">
                        <a class="nav-link blue" id="nav-color" href="#des">Diagnose</a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="header">
            <!--<img  src="Images/Picture3.png" class="img-fluid w-100 postion-relative" alt="Responsive image">-->
            <div class="container">
                <div class="row">
                    <div class="col-md-6 title">
                        <div class="hh">
                            <h1 id="h1">Skin Diseases</h1>
                        </div>
                        <div class="pp"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!--Avatar-->
    <div class="Diagnose">
        <section id="des" class="des container "><!--about us section-->
            <div class="section-title">
                <h2><b>Diagnose</b></h2>
            </div>
            <hr class="mx-auto" width="15%" color="#55E1F8" size="5px" align="left" />
            <div class="content">
                <p>Upload Your Image and get you results</p>
            </div>
        </section>
        <div class="d-flex justify-content-center mb-4">
            <img src="/static/Images/Picture2.png" class="rounded-circle" alt="example placeholder"
                style="width: 200px;" />
        </div>
        <div class="d-flex justify-content-center">
            <div class="btn btn-primary btn-rounded">
                <div class="checker_form" id="checker-form">
                    <div class="drag-area row text-center justify-content-center">
                        <div class="icon"><i class="fas fa-cloud-upload-alt"></i></div>
                        <header class="drag-drop">Drag & Drop to Upload File</header>
                        <span>OR</span>
                        <button class="upload-btn">Browse File</button>
                        <input id="fileUpload" class="upload-file" type="file" hidden>
                    </div>
                    <div class="row">
                        <div class="col button text-left">
                            <button id="cancel-upload" onclick="cancelUpload()" class="submit_btn">Cancel</button>
                        </div>
                        <div class="col button text-right">
                            <button id="submit-upload" onclick="submitUpload()" class="submit_btn">Submit</button>
                        </div>
                        {% if error %}
                        <div class="error-box">
                            {{ error }}
                        </div>
                        {% endif %}
                        <h2 id="tumor-name"></h2>
                        <h2 id="percentage-of-prediction"></h2>
                    </div>
                </div>
            </div>
        </div>

</body>
<script>
    function submitUpload() {
        var data = new FormData()
        data.append('files', file) // maybe it should be '{target}_cand'
        data.append('name', file.name)

        let url = "/prediction-covid"
        fetch(url, {
            method: 'POST',
            body: data,
            }).then(function (response) {
                return response.json()
            }).then(function (res) {
                let tumor_type = res.tumor_type;
                let confidence_score = res.confidence_score;
                document.getElementById("tumor-name").innerText = 'Disease Name:' + tumor_type;
                document.getElementById("percentage-of-prediction").innerText = 'Percentage of Prediction success:' + confidence_score;
            })
    };
    function cancelUpload() {
        //selecting all required elements
        var dropArea = document.querySelector(".drag-area");
        var uploadedImage = dropArea.querySelector("#uploaded-image");
        var newArea = `<div class="icon"><i class="fas fa-cloud-upload-alt"></i></div>
                        <header class="drag-drop">Drag & Drop to Upload File</header>
                        <span>OR</span>
                        <button class="upload-btn">Browse File</button>
                        <input id="fileUpload" class="upload-file" type="file" hidden>`;
        dropArea.classList.remove("active");
        dropArea.removeChild(uploadedImage);
        dropArea.insertAdjacentHTML("afterbegin", newArea);
        var dragText = dropArea.querySelector(".drag-drop");
        var button = dropArea.querySelector(".upload-btn");
        var input = dropArea.querySelector(".upload-file");
        button.onclick = () => {
            input.click(); //if user click on the button then the input also clicked
        }
        input.addEventListener("change", function () {
            //getting user select file and [0] this means if user select multiple files then we'll select only the first one
            file = this.files[0];
            fileName = file.name;
            dropArea.classList.add("active");
            showFile(); //calling function
        });
        //If user Drag File Over DropArea
        dropArea.addEventListener("dragover", (event) => {
            event.preventDefault(); //preventing from default behaviour
            dropArea.classList.add("active");
            dragText.textContent = "Release to Upload File";
        });
        //If user leave dragged File from DropArea
        dropArea.addEventListener("dragleave", () => {
            dropArea.classList.remove("active");
            dragText.textContent = "Drag & Drop to Upload File";
        });
        //If user drop File on DropArea
        dropArea.addEventListener("drop", (event) => {
            event.preventDefault(); //preventing from default behaviour
            //getting user select file and [0] this means if user select multiple files then we'll select only the first one
            file = event.dataTransfer.files[0];
            fileName = file.name;
            showFile(); //calling function
        });
        function showFile() {
            let fileType = file.type; //getting selected file type
            let validExtensions = ["image/jpeg", "image/jpg", "image/png"]; //adding some valid image extensions in array
            if (validExtensions.includes(fileType)) { //if user selected file is an image file
                let fileReader = new FileReader(); //creating new FileReader object
                fileReader.onload = () => {
                    let fileURL = fileReader.result; //passing user file source in fileURL variable
                    let imgTag = `<img id="uploaded-image" src="${fileURL}" alt="${file.name}">`; //creating an img tag and passing user selected file source inside src attribute
                    dropArea.innerHTML = imgTag; //adding that created img tag inside dropArea container
                }
                fileReader.readAsDataURL(file);
            } else {
                alert("This is not an Image File!");
                dropArea.classList.remove("active");
                dragText.textContent = "Drag & Drop to Upload File";
            }
        }
    };
</script>
<script src="../static/upload.js"></script>
</html>